{"version":3,"file":"Map.js","sourceRoot":"","sources":["../src/Map.tsx"],"names":[],"mappings":"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","sourcesContent":["import React from \"react\";\nimport {\n  NativeExpoAppleMapsView,\n  NativeExpoGoogleMapsView,\n} from \"./NativeExpoMapView\";\nimport {\n  DefaultNativeExpoMapViewProps,\n  ExpoMapState,\n  ExpoMapViewProps,\n} from \"./Map.types\";\nimport { Asset } from \"expo-asset\";\nimport { Platform } from \"react-native\";\nimport * as Utils from \"./Utils\";\nimport { MarkerColor, MarkerObject } from \"./Marker\";\nimport { PolygonObject } from \"./Polygon\";\nimport { PolylineObject } from \"./Polyline\";\nimport { CircleObject } from \"./Circle\";\n\nexport { Marker } from \"./Marker\";\nexport { Polygon } from \"./Polygon\";\nexport { Polyline } from \"./Polyline\";\nexport { Circle } from \"./Circle\";\n\nconst defaultNativeExpoMapViewProps: DefaultNativeExpoMapViewProps = {\n  mapType: \"normal\",\n  showZoomControls: true,\n  showCompass: true,\n  showMapToolbar: true,\n  showMyLocationButton: true,\n  showLevelPicker: true,\n  enableRotateGestures: false,\n  enableScrollGestures: true,\n  enableTiltGestures: false,\n  enableZoomGestures: true,\n};\n\nexport class ExpoMap extends React.Component<ExpoMapViewProps> {\n  state: ExpoMapState = {\n    markers: [],\n    polygons: [],\n    polylines: [],\n    circles: [],\n  };\n  _ismounted = false;\n\n  componentDidMount() {\n    this.mapChildren();\n    this._ismounted = true;\n  }\n\n  componentWillUnmount() {\n    this._ismounted = false;\n  }\n\n  componentDidUpdate(_, prevState: ExpoMapState) {\n    if (Object.is(this.state, prevState)) {\n      this.mapChildren();\n    }\n  }\n\n  private async mapChildren() {\n    const childrenArray = React.Children.map(\n      this.props.children,\n      async (child) => {\n        if (!Utils.isSimpleType(child)) {\n          if (Utils.isMarker(child)) {\n            let iconPath: Asset | undefined = undefined;\n            if (child.props.icon !== undefined) {\n              iconPath = await Asset.fromModule(\n                child.props.icon\n              ).downloadAsync();\n            }\n\n            let markerObject = {\n              type: \"marker\",\n              latitude: child.props.latitude,\n              longitude: child.props.longitude,\n              title: child.props.title,\n              snippet: child.props.snippet,\n              icon: iconPath?.localUri,\n              defaultMarkerColor: 0,\n              draggable: child.props.draggable ? child.props.draggable : false,\n              anchorU: child.props.anchorU,\n              anchorV: child.props.anchorV,\n              opacity: child.props.opacity ? child.props.opacity : 1,\n            } as MarkerObject;\n\n            if (child.props.defaultMarkerColor != undefined) {\n              if (typeof child.props.defaultMarkerColor === \"number\") {\n                markerObject.defaultMarkerColor =\n                  child.props.defaultMarkerColor!;\n              } else {\n                markerObject.defaultMarkerColor = mapColor(\n                  child.props.defaultMarkerColor\n                );\n              }\n            }\n            return markerObject;\n          } else if (Utils.isPolygon(child)) {\n            return {\n              type: \"polygon\",\n              points: child.props.points,\n              fillColor: child.props.fillColor,\n              strokeColor: child.props.strokeColor,\n              strokeWidth: child.props.strokeWidth,\n              strokePattern: child.props.strokePattern,\n              jointType: child.props.jointType,\n            } as PolygonObject;\n          } else if (Utils.isPolyline(child)) {\n            return {\n              type: \"polyline\",\n              points: child.props.points,\n              color: child.props.color,\n              width: child.props.width,\n              pattern: child.props.pattern,\n              jointType: child.props.jointType,\n              capType: child.props.capType,\n            } as PolylineObject;\n          } else if (Utils.isCircle(child)) {\n            return {\n              type: \"circle\",\n              center: child.props.center,\n              radius: child.props.radius,\n              fillColor: child.props.fillColor,\n              strokeColor: child.props.strokeColor,\n              strokeWidth: child.props.strokeWidth,\n            } as CircleObject;\n          }\n        }\n        warnIfChildIsIncompatible(child);\n        return null;\n      }\n    );\n\n    if (childrenArray != undefined) {\n      let propObjects = await Promise.all(childrenArray);\n      if (this._ismounted) {\n        this.setState({\n          markers: propObjects.filter((elem) => elem?.type === \"marker\"),\n          polygons: propObjects.filter((elem) => elem?.type === \"polygon\"),\n          polylines: propObjects.filter((elem) => elem?.type === \"polyline\"),\n          circles: propObjects.filter((elem) => elem?.type === \"circle\"),\n        });\n      }\n    }\n  }\n\n  render() {\n    if (Platform.OS == \"ios\" && this.props.provider == \"apple\") {\n      return (\n        <NativeExpoAppleMapsView\n          {...defaultNativeExpoMapViewProps}\n          {...this.props}\n          markers={this.state.markers}\n          polygons={this.state.polygons}\n          polylines={this.state.polylines}\n          circles={this.state.circles}\n        />\n      );\n    }\n\n    return (\n      <NativeExpoGoogleMapsView\n        {...defaultNativeExpoMapViewProps}\n        {...this.props}\n        googleMapsJsonStyleString={\n          this.props.googleMapsJsonStyleString\n            ? this.props.googleMapsJsonStyleString\n            : \"\"\n        }\n        markers={this.state.markers}\n        polygons={this.state.polygons}\n        polylines={this.state.polylines}\n        circles={this.state.circles}\n      />\n    );\n  }\n}\n\nfunction warnIfChildIsIncompatible(child: any) {\n  if (\n    typeof child == \"string\" ||\n    typeof child == \"boolean\" ||\n    typeof child == \"number\"\n  ) {\n    console.warn(\n      `Warning! Child of type ${typeof child} isn't valid ExpoMap child!`\n    );\n  } else if (child != null && child != undefined) {\n    console.log(child.type);\n    console.warn(\n      `Warning! Child of type ${\n        (child as React.ReactElement<any>).type\n      } isn't valid ExpoMap child!`\n    );\n  }\n}\n\nfunction mapColor(color: MarkerColor): number {\n  switch (color) {\n    case \"azure\": {\n      return 210;\n    }\n    case \"blue\": {\n      return 240;\n    }\n    case \"cyan\": {\n      return 180;\n    }\n    case \"green\": {\n      return 120;\n    }\n    case \"magenta\": {\n      return 300;\n    }\n    case \"orange\": {\n      return 30;\n    }\n    case \"rose\": {\n      return 330;\n    }\n    case \"violet\": {\n      return 270;\n    }\n    case \"yellow\": {\n      return 60;\n    }\n    default: {\n      return 0;\n    }\n  }\n}\n"]}