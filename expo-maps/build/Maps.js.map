{"version":3,"file":"Maps.js","sourceRoot":"","sources":["../src/Maps.tsx"],"names":[],"mappings":"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","sourcesContent":["import React from 'react';\nimport {\n  ExpoMapViewProps,\n  MarkerProps,\n  MarkerObject,\n  MarkerColor,\n  PolygonProps,\n  PolygonObject,\n  PolylineObject,\n  DefaultNativeExpoMapViewProps,\n  ExpoMapState,\n} from './Maps.types';\nimport {\n  NativeExpoAppleMapsView,\n  NativeExpoGoogleMapsView,\n} from './NativeExpoMapView';\nimport { Asset } from 'expo-asset';\nimport { Platform } from 'react-native';\n\nconst defaultNativeExpoMapViewProps: DefaultNativeExpoMapViewProps = {\n  mapType: 'normal',\n  showZoomControls: true,\n  showCompass: true,\n  showMapToolbar: true,\n  showMyLocationButton: true,\n  showLevelPicker: true,\n  enableRotateGestures: false,\n  enableScrollGestures: true,\n  enableTiltGestures: false,\n  enableZoomGestures: true,\n};\n\nexport class ExpoMap extends React.Component<ExpoMapViewProps> {\n  state: ExpoMapState = {\n    markers: [],\n    polygons: [],\n    polylines: [],\n  };\n  _ismounted = false;\n\n  componentDidMount() {\n    this.mapChildren();\n    this._ismounted = true;\n  }\n\n  componentWillUnmount() {\n    this._ismounted = false;\n  }\n\n  componentDidUpdate(_, prevState: ExpoMapState) {\n    if (Object.is(this.state, prevState)) {\n      this.mapChildren();\n    }\n  }\n\n  private async mapChildren() {\n    const childrenArray = React.Children.map(\n      this.props.children,\n      async (child) => {\n        if (!isSimpleType(child)) {\n          if (instanceOfMarker(child)) {\n            let iconPath: Asset | undefined = undefined;\n            if (child.props.icon !== undefined) {\n              iconPath = await Asset.fromModule(\n                child.props.icon\n              ).downloadAsync();\n            }\n\n            let markerObject = {\n              type: 'marker',\n              latitude: child.props.latitude,\n              longitude: child.props.longitude,\n              title: child.props.title,\n              snippet: child.props.snippet,\n              icon: iconPath?.localUri,\n              defaultMarkerColor: 0,\n              draggable: child.props.draggable ? child.props.draggable : false,\n              anchorU: child.props.anchorU,\n              anchorV: child.props.anchorV,\n              opacity: child.props.opacity ? child.props.opacity : 1,\n            } as MarkerObject;\n\n            if (child.props.defaultMarkerColor != undefined) {\n              if (typeof child.props.defaultMarkerColor === 'number') {\n                markerObject.defaultMarkerColor =\n                  child.props.defaultMarkerColor!;\n              } else {\n                markerObject.defaultMarkerColor = mapColor(\n                  child.props.defaultMarkerColor\n                );\n              }\n            }\n            return markerObject;\n          } else if (instanceOfPolygon(child)) {\n            return {\n              type: 'polygon',\n              points: child.props.points,\n            } as PolygonObject;\n          } else if (instanceOfPolyline(child)) {\n            return {\n              type: 'polyline',\n              points: child.props.points,\n            } as PolylineObject;\n          }\n        }\n        warnIfChildIsIncompatible(child);\n        return null;\n      }\n    );\n\n    if (childrenArray != undefined) {\n      let propObjects = await Promise.all(childrenArray);\n      if (this._ismounted) {\n        this.setState({\n          markers: propObjects.filter((elem) => elem?.type === 'marker'),\n          polygons: propObjects.filter((elem) => elem?.type === 'polygon'),\n          polylines: propObjects.filter((elem) => elem?.type === 'polyline'),\n        });\n      }\n    }\n  }\n\n  render() {\n    console.log(this.props.provider);\n    if (Platform.OS == 'ios' && this.props.provider == 'apple') {\n      return (\n        <NativeExpoAppleMapsView\n          {...defaultNativeExpoMapViewProps}\n          {...this.props}\n          markers={this.state.markers}\n          polygons={this.state.polygons}\n          polylines={this.state.polylines}\n        />\n      );\n    }\n\n    return (\n      <NativeExpoGoogleMapsView\n        {...defaultNativeExpoMapViewProps}\n        {...this.props}\n        googleMapsJsonStyleString={\n          this.props.googleMapsJsonStyleString\n            ? this.props.googleMapsJsonStyleString\n            : ''\n        }\n        markers={this.state.markers}\n        polygons={this.state.polygons}\n        polylines={this.state.polylines}\n      />\n    );\n  }\n}\n\nexport class Marker extends React.Component<MarkerProps> {\n  render() {\n    return null;\n  }\n}\n\nfunction mapColor(color: MarkerColor): number {\n  switch (color) {\n    case 'azure': {\n      return 210;\n    }\n    case 'blue': {\n      return 240;\n    }\n    case 'cyan': {\n      return 180;\n    }\n    case 'green': {\n      return 120;\n    }\n    case 'magenta': {\n      return 300;\n    }\n    case 'orange': {\n      return 30;\n    }\n    case 'rose': {\n      return 330;\n    }\n    case 'violet': {\n      return 270;\n    }\n    case 'yellow': {\n      return 60;\n    }\n  }\n  return 0;\n}\n\nfunction instanceOfMarker(child: any): child is Marker {\n  if ('type' in child && String(child.type).includes('Marker') && 'props' in child) {\n    let props = Object.keys(child.props);\n    if (props.includes('latitude') && props.includes('longitude')) {\n      return true;\n    }\n  }\n  return false;\n}\n\nexport class Polygon extends React.Component<PolygonProps> {\n  render() {\n    return null;\n  }\n}\n\nfunction instanceOfPolygon(child: any): child is Polygon {\n  if ('type' in child && String(child.type).includes('Polygon') && 'props' in child) {\n    let props = Object.keys(child.props);\n    if (props.includes('points')) {\n      return true;\n    }\n  }\n  return false;\n}\n\nexport class Polyline extends React.Component<PolygonProps> {\n  render() {\n    return null;\n  }\n}\n\nfunction instanceOfPolyline(child: any): child is Polyline {\n  if ('type' in child && String(child.type).includes('Polyline') && 'props' in child) {\n    let props = Object.keys(child.props);\n    if (props.includes('points')) {\n      return true;\n    }\n  }\n  return false;\n}\n\nfunction warnIfChildIsIncompatible(child: any) {\n  if (typeof child == 'string' || typeof child == 'boolean' || typeof child == 'number') {\n    console.warn(`Warning! Child of type ${typeof child} isn't valid ExpoMap child!`);\n  } else if (child != null && child != undefined) {\n    console.log(child.type);\n    console.warn(`Warning! Child of type ${(child as React.ReactElement<any>).type} isn't valid ExpoMap child!`);\n  }\n}\n\nfunction isSimpleType(child: any) {\n  return (\n    typeof child == 'string' ||\n    typeof child == 'boolean' ||\n    typeof child == 'number' ||\n    child == null ||\n    child == undefined\n  );\n}\n"]}